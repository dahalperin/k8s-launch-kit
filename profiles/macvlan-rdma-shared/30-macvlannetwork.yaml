{{if .Macvlan.SeparateNetworkPerDevice}}
{{/* Create separate MacVLAN networks for each network interface */}}
{{range $i, $iface := .ClusterConfig.NvidiaNICs.PF.NetworkInterfaces}}
apiVersion: mellanox.com/v1alpha1
kind: MacvlanNetwork
metadata:
  name: {{$.Macvlan.NetworkName}}-{{printf "%c" (add 97 $i)}}
spec:
  networkNamespace: "default"
  master: "{{$iface}}"
  mode: "bridge"
  mtu: {{$.Sriov.Mtu}}
  ipam: |
    {
      "type": "nv-ipam",
      "poolName": "{{$.NvIpam.PoolName}}-{{printf "%c" (add 97 $i)}}"
    }
{{if ne $i (sub (len $.ClusterConfig.NvidiaNICs.PF.NetworkInterfaces) 1)}}---{{end}}
{{end}}
{{else if .Macvlan.SingleNetworkForAllDevices}}
{{/* Create single shared MacVLAN network for all devices */}}
apiVersion: mellanox.com/v1alpha1
kind: MacvlanNetwork
metadata:
  name: {{.Macvlan.NetworkName}}
spec:
  networkNamespace: "default"
  master: "{{index .ClusterConfig.NvidiaNICs.PF.NetworkInterfaces 0}}"
  mode: "bridge"
  mtu: {{.Sriov.Mtu}}
  ipam: |
    {
      "type": "nv-ipam",
      "poolName": "{{.NvIpam.PoolName}}"
    }
{{else}}
{{/* Default: Create network only for the first device */}}
apiVersion: mellanox.com/v1alpha1
kind: MacvlanNetwork
metadata:
  name: {{.Macvlan.NetworkName}}
spec:
  networkNamespace: "default"
  master: "{{index .ClusterConfig.NvidiaNICs.PF.NetworkInterfaces 0}}"
  mode: "bridge"
  mtu: {{.Sriov.Mtu}}
  ipam: |
    {
      "type": "nv-ipam",
      "poolName": "{{.NvIpam.PoolName}}"
    }
{{end}}